name: Build and Deploy Frontend

on:
    push:
        branches: [main, master]
        paths:
            - '**'
            - '!README.md'
            - '!.github/**'

jobs:
    build-and-deploy:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout code
              uses: actions/checkout@v3

            - name: Set up Docker Buildx
              uses: docker/setup-buildx-action@v2

            - name: Login to DockerHub
              uses: docker/login-action@v2
              with:
                  username: ${{ secrets.DOCKERHUB_USERNAME }}
                  password: ${{ secrets.DOCKERHUB_TOKEN }}

            - name: Build and push Docker image
              uses: docker/build-push-action@v4
              with:
                  context: .
                  push: true
                  platforms: linux/amd64
                  tags: ershovone/commit-tms-fe:latest

            - name: Deploy to Kubernetes
              uses: wahyd4/kubectl-helm-action@master
              env:
                  KUBE_CONFIG_DATA: ${{ secrets.KUBE_CONFIG }}
              with:
                  args: rollout restart deployment commit-tms-fe -n commit-tms-be
